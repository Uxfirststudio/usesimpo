<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthetic Data Generator | Simpo API</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --stripe-blue: #635bff;
            --stripe-dark: #0a2540;
            --stripe-light: #f6f9fc;
            --stripe-green: #00d4a1;
            --stripe-red: #ff3d71;
            --stripe-orange: #ff8a00;
            --stripe-gray: #6b7c93;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        body {
            background: linear-gradient(150deg, #ffffff 10%, #f8fafc 70%, #f1f5f9 95%);
            color: var(--stripe-dark);
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--stripe-dark);
        }
        .subtitle {
            color: var(--stripe-gray);
            font-size: 18px;
        }
        .card {
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid #e6ebf1;
            box-shadow: 0 6px 24px rgba(10, 37, 64, 0.04);
            padding: 24px;
            margin-bottom: 24px;
        }
        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--stripe-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-title i {
            color: var(--stripe-blue);
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--stripe-dark);
        }
        .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e6ebf1;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--stripe-blue);
            box-shadow: 0 0 0 3px rgba(99, 91, 255, 0.1);
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--stripe-blue);
            color: white;
        }
        .btn-secondary {
            background: var(--stripe-green);
            color: white;
        }
        .btn:hover { opacity: 0.95; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(99, 91, 255, 0.18); }
        .btn:active { transform: translateY(0); box-shadow: none; }
        .btn:focus { outline: none; box-shadow: 0 0 0 3px rgba(99, 91, 255, 0.2); }
        .actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .results {
            margin-top: 30px;
        }
        .data-preview {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            overflow: auto;
            max-height: 400px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e6ebf1;
        }
        thead th { position: sticky; top: 0; z-index: 1; background: #ffffff; font-weight: 600; color: var(--stripe-dark); border-bottom: 1px solid #e6ebf1; }
        tbody tr:nth-child(even) { background: #fafbfe; }
        tbody tr:hover { background-color: #f3f6fb; }
        .fraud-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.2px;
        }
        .fraud-yes {
            background: rgba(255, 61, 113, 0.1);
            color: var(--stripe-red);
        }
        .fraud-no {
            background: rgba(0, 212, 161, 0.1);
            color: var(--stripe-green);
        }
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        .chart-card { background: #ffffff; border-radius: 12px; border: 1px solid #e6ebf1; box-shadow: 0 6px 24px rgba(10, 37, 64, 0.04); padding: 16px 16px 8px; }
        .chart-title { font-size: 14px; font-weight: 700; letter-spacing: .02em; text-transform: uppercase; color: #64748b; margin-bottom: 8px; }
        .chart-wrapper {
            height: 300px;
            position: relative;
        }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: #ffffff; border-radius: 12px; border: 1px solid #e6ebf1; box-shadow: 0 6px 24px rgba(10, 37, 64, 0.04); padding: 16px; display: flex; align-items: center; gap: 12px; }
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .stat-1 {
            background: rgba(99, 91, 255, 0.1);
            color: var(--stripe-blue);
        }
        .stat-2 {
            background: rgba(255, 61, 113, 0.1);
            color: var(--stripe-red);
        }
        .stat-3 {
            background: rgba(0, 212, 161, 0.1);
            color: var(--stripe-green);
        }
        .stat-4 {
            background: rgba(255, 138, 0, 0.1);
            color: var(--stripe-orange);
        }
        .stat-info {
            flex: 1;
        }
        .stat-value { font-size: 22px; font-weight: 700; margin-bottom: 2px; letter-spacing: -0.01em; }
        .stat-label { font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 0.04em; }
        .notification {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notification-success {
            background: rgba(0, 212, 161, 0.1);
            color: var(--stripe-green);
            border-left: 4px solid var(--stripe-green);
        }
        .notification-error {
            background: rgba(255, 61, 113, 0.1);
            color: var(--stripe-red);
            border-left: 4px solid var(--stripe-red);
        }
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(10,37,64,0.25);
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content { background: #ffffff; border-radius: 12px; border: 1px solid #e6ebf1; box-shadow: 0 24px 60px rgba(10, 37, 64, 0.18); padding: 28px; min-width: 360px; max-width: 880px; position: relative; }
        .modal-content h2 { margin-bottom: 16px; color: var(--stripe-dark); font-size: 20px; font-weight: 700; letter-spacing: -0.01em; }
        .modal-content .close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--stripe-gray);
            cursor: pointer;
        }
        .modal-content .close:hover {
            color: var(--stripe-red);
        }

        /* Responsive styles */
        @media (max-width: 900px) {
            .container {
                padding: 10px;
            }
            .form-grid, .stats-grid, .charts-container {
                grid-template-columns: 1fr;
            }
            .charts-container {
                gap: 10px;
            }
            .card, .chart-card, .stat-card {
                padding: 16px;
            }
            .modal-content {
                padding: 20px;
                min-width: 240px;
                max-width: 98vw;
            }
            .charts-container {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    .chart-wrapper {
        height: 220px;
        min-height: 180px;
        max-height: 260px;
    }
}

@media (max-width: 700px) {
    .chart-wrapper {
        height: 180px;
        min-height: 120px;
        max-height: 200px;
    }
}

@media (max-width: 500px) {
    .chart-wrapper {
        height: 140px;
        min-height: 80px;
        max-height: 160px;
    }
}

/* Make canvas fill parent */
.chart-wrapper canvas {
    width: 100% !important;
    height: 100% !important;
    display: block;
}
        @media (max-width: 700px) {
            .container {
                padding: 4px;
            }
            header {
                margin-bottom: 18px;
            }
            h1 {
                font-size: 20px;
            }
            .subtitle {
                font-size: 13px;
            }
            .card-title, .chart-title {
                font-size: 15px;
            }
            .form-label, .stat-label {
                font-size: 12px;
            }
            .form-input, .form-select {
                font-size: 13px;
                padding: 8px 10px;
            }
            .btn {
                font-size: 13px;
                padding: 8px 12px;
            }
            .data-preview {
                padding: 6px;
                font-size: 12px;
            }
            table th, table td {
                padding: 6px 4px;
                font-size: 11px;
            }
            .modal-content {
                padding: 8px;
                min-width: 120px;
                max-width: 99vw;
            }
            .actions {
                flex-direction: column;
                gap: 8px;
            }
            .form-grid {
                gap: 8px;
            }
            .stat-card {
                flex-direction: column;
                gap: 6px;
                padding: 6px;
            }
            .stat-icon {
                width: 28px;
                height: 28px;
                font-size: 13px;
            }
        }

        @media (max-width: 500px) {
            .container {
                padding: 2px;
            }
            .card, .chart-card, .stat-card {
                padding: 4px;
            }
            .modal-content {
                padding: 4px;
                min-width: 80px;
                max-width: 100vw;
            }
            .charts-container .chart-wrapper {
                height: 180px;
            }
        }

        /* Make table scrollable on small screens */
        .data-preview {
            overflow-x: auto;
            max-width: 100vw;
        }
    </style>
</head>
<body>
    <header>
        <div class="container" style="text-align:left; padding:16px 0;">
            <a href="index.html" class="logo" style="font-weight:700; font-size:22px; color:#635bff; text-decoration:none;">Simpo</a>
        </div>
    </header>
    <div class="container">
        <header>
            <h1>Synthetic Data Generator</h1>
            <p class="subtitle">Generate realistic transaction data for training your fraud detection AI</p>
        </header>

        <div class="notification notification-success">
            <i class="fas fa-info-circle"></i>
            <span>This tool generates synthetic transaction data with both legitimate and fraudulent patterns for AI training.</span>
        </div>

        <div class="card">
            <div class="card-title">
                <i class="fas fa-sliders-h"></i>
                <span>Data Generation Parameters</span>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Data Type</label>
                    <select class="form-select" id="datasetType">
                        <option value="transactions" selected>Transactions</option>
                        <option value="loans">Loan Applications</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Number of Transactions</label>
                    <input type="number" class="form-input" id="numTransactions" value="1000" min="100" max="100000">
                </div>
                <div class="form-group">
                    <label class="form-label">Fraud Percentage</label>
                    <input type="number" class="form-input" id="fraudPercentage" value="5" min="1" max="50">
                    <span class="form-hint">% of transactions that should be fraudulent</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Time Range</label>
                    <select class="form-select" id="timeRange">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Transaction Types</label>
                    <select class="form-select" id="transactionTypes" multiple>
                        <option value="p2p" selected>Peer-to-Peer</option>
                        <option value="merchant" selected>Merchant Payment</option>
                        <option value="bill" selected>Bill Payment</option>
                        <option value="airtime" selected>Airtime Purchase</option>
                    </select>
                    <span class="form-hint">Hold Ctrl/Cmd to select multiple</span>
                </div>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Average Amount (UGX)</label>
                    <input type="number" class="form-input" id="avgAmount" value="75000" min="1000" max="10000000">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount Deviation</label>
                    <input type="number" class="form-input" id="amountDeviation" value="50000" min="1000" max="500000">
                </div>
                <div class="form-group">
                    <label class="form-label">Include User Behavior</label>
                    <select class="form-select" id="includeBehavior">
                        <option value="yes" selected>Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Data Format</label>
                    <select class="form-select" id="dataFormat">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>
            </div>
            <div class="card" style="margin-top:10px;">
                <div class="card-title">
                    <i class="fas fa-robot"></i>
                    <span>Automations & Notifications</span>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Transaction Hold / Freeze</label>
                        <select class="form-select" id="enableHold">
                            <option value="yes" selected>Enabled</option>
                            <option value="no">Disabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Account Lock on Signals ≥</label>
                        <input type="number" class="form-input" id="lockThreshold" value="2" min="1" max="5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Customer Verification</label>
                        <select class="form-select" id="enableVerification">
                            <option value="yes" selected>Enabled</option>
                            <option value="no">Disabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Internal Alert</label>
                        <select class="form-select" id="enableInternalAlert">
                            <option value="yes" selected>Enabled</option>
                            <option value="no">Disabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Customer Notification (Optional)</label>
                        <select class="form-select" id="enableCustomerNotification">
                            <option value="no" selected>Disabled</option>
                            <option value="yes">Enabled</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="generateData()">
                    <i class="fas fa-plus"></i> Generate Data
                </button>
                <button class="btn btn-secondary" onclick="downloadData()" id="downloadBtn" disabled>
                    <i class="fas fa-download"></i> Download Dataset
                </button>
                <button class="btn" style="background:#eef2ff; color:#0a2540;" type="button" onclick="openWorkflow()">
                    <i class="fas fa-sitemap" style="color:#635bff;"></i> Fraud Workflow
                </button>
            </div>
        </div>
        <div class="stats-grid" id="statsContainer" style="display: none;">
            <div class="stat-card">
                <div class="stat-icon stat-1">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="totalTransactions">0</div>
                    <div class="stat-label">Total Transactions</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon stat-2">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="fraudTransactions">0</div>
                    <div class="stat-label">Fraudulent Transactions</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon stat-3">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="totalAmount">0</div>
                    <div class="stat-label">Total Amount (UGX)</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon stat-4">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="uniqueUsers">0</div>
                    <div class="stat-label">Unique Users</div>
                </div>
            </div>
        </div>
        <div class="charts-container" id="chartsContainer" style="display: none;">
            <div class="chart-card">
                <div class="chart-title">Transactions by Type</div>
                <div class="chart-wrapper">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-title">Fraud Distribution</div>
                <div class="chart-wrapper">
                    <canvas id="fraudChart"></canvas>
                </div>
            </div>
        </div>
        <div class="card results" id="resultsContainer" style="display: none;">
            <div class="card-title">
                <i class="fas fa-table"></i>
                <span>Generated Data Preview</span>
            </div>
            <div class="form-grid" style="margin-bottom: 10px;">
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="filterDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Is Fraud</label>
                    <select class="form-select" id="filterFraud">
                        <option value="">All</option>
                        <option value="true">Fraudulent</option>
                        <option value="false">Legitimate</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Provider</label>
                    <select class="form-select" id="filterProvider">
                        <option value="">All</option>
                        <option value="MTN">MTN</option>
                        <option value="Airtel">Airtel</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Fraud Reason</label>
                    <select class="form-select" id="filterReason">
                        <option value="">All</option>
                        <option value="Unusual location">Unusual location</option>
                        <option value="Unusual amount">Unusual amount</option>
                        <option value="Unusual time">Unusual time</option>
                        <option value="New device/provider">New device/provider</option>
                    </select>
                </div>
            </div>
            
            <div class="data-preview">
                <table id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
                <!-- <div class="form-grid" style="margin-bottom: 10px;">
                <div class="form-group">
                    <label class="form-label">Rows per page</label>
                    <select class="form-select" id="rowsPerPage">
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="all">View All</option>
                    </select>
                </div> -->
            <!-- </div> -->
                <div style="margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
                    <button class="btn btn-primary" type="button" onclick="setRowsPerPage(25)">View 25</button>
                    <button class="btn btn-primary" type="button" onclick="setRowsPerPage(50)">View 50</button>
                    <button class="btn btn-primary" type="button" onclick="setRowsPerPage(100)">View 100</button>
                    <button class="btn btn-secondary" type="button" onclick="setRowsPerPage('all')">View All</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Detail Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <button class="close" onclick="closeModal()">&times;</button>
            <h2 id="modalTitle">Transaction Details</h2>
            <div id="modalContent"></div>
        </div>
    </div>
    <!-- Workflow Modal -->
    <div class="modal" id="workflowModal">
        <div class="modal-content">
            <button class="close" onclick="closeWorkflow()">&times;</button>
            <h2 style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-sitemap" style="color:#635bff;"></i>
                Fraud Detection Workflow
            </h2>
            <div style="color:#425466;">
                <div style="margin:14px 0 8px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.04em; color:#64748b;">1. Transaction Monitoring</div>
                <ul style="margin:0 0 14px 18px;">
                    <li>Unusual sizes relative to user baseline</li>
                    <li>High-frequency bursts</li>
                    <li>Risky cross-border corridors</li>
                    <li>Time anomalies (e.g., midnight activity)</li>
                </ul>
                <div style="font-size:14px; margin:0 0 18px;">Simpo: real-time risk scoring on each API call (low/medium/high).</div>

                <div style="margin:14px 0 8px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.04em; color:#64748b;">2. Customer Behavior Analytics</div>
                <ul style="margin:0 0 14px 18px;">
                    <li>Sudden pattern shifts</li>
                    <li>New device or IP</li>
                    <li>Multiple failed auth attempts</li>
                </ul>
                <div style="font-size:14px; margin:0 0 18px;">Simpo: per-user baselines with deviation flags.</div>

                <div style="margin:14px 0 8px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.04em; color:#64748b;">3. Device & Identity Intelligence</div>
                <ul style="margin:0 0 14px 18px;">
                    <li>SIM swaps, rooted devices, device changes</li>
                    <li>Repeat signups from same device/IP</li>
                    <li>Synthetic identities (similar KYC across accounts)</li>
                </ul>
                <div style="font-size:14px; margin:0 0 18px;">Simpo: cross-client shared fraud intelligence.</div>

                <div style="margin:14px 0 8px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.04em; color:#64748b;">4. Network & Account Linkage</div>
                <ul style="margin:0 0 14px 18px;">
                    <li>Exposure to flagged counterparties</li>
                    <li>Circular flows</li>
                    <li>Collusion rings</li>
                </ul>
                <div style="font-size:14px;">Simpo: graph analysis to surface hidden rings.</div>
            </div>
        </div>
    </div>
    <footer>
        <div class="container footer-inner" style="padding:32px 0; border-top:1px solid #e6ebf1; margin-top:40px;">
            <div style="display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:10px;">
                <div>
                    <span style="font-weight:600; color:#635bff;">Simpo API</span> &copy; 2025
                </div>
                <div style="font-size:14px; color:#6b7c93;">
                    <a href="index.html#features" style="margin-right:16px; color:inherit; text-decoration:none;">Features</a>
                    <a href="index.html#pricing" style="margin-right:16px; color:inherit; text-decoration:none;">Pricing</a>
                    <a href="index.html#faq" style="color:inherit; text-decoration:none;">FAQ</a>
                </div>
                <div>
                    <a href="https://twitter.com/simpoapi" target="_blank" style="color:#635bff; margin-right:8px;"><i class="fab fa-twitter"></i></a>
                    <a href="mailto:business@usesimpo.com" style="color:#635bff;"><i class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        // --- Data Generation ---
        const locations = ['Kampala', 'Entebbe', 'Jinja', 'Gulu', 'Mbale', 'Lira', 'Mbarara', 'Fort Portal'];
        const providers = ['MTN', 'Airtel'];
        const transactionTypes = ['p2p', 'merchant', 'bill', 'airtime'];
        const merchantCategories = ['Retail', 'Food & Dining', 'Entertainment', 'Transportation', 'Services'];
        const deviceTypes = ['iOS', 'Android', 'Web'];
        const regions = ['Central', 'Western', 'Eastern', 'Northern'];
        const channels = ['Branch', 'Agent', 'Online'];
        let generatedData = [];
        let typeChartInstance = null;
        let fraudChartInstance = null;
        let currentDataset = 'transactions';

        function generateData() {
            const numTransactions = parseInt(document.getElementById('numTransactions').value);
            const fraudPercentage = parseInt(document.getElementById('fraudPercentage').value);
            const timeRange = parseInt(document.getElementById('timeRange').value);
            const avgAmount = parseInt(document.getElementById('avgAmount').value);
            const amountDeviation = parseInt(document.getElementById('amountDeviation').value);
            currentDataset = document.getElementById('datasetType').value;

            generatedData = [];
            if (currentDataset === 'transactions') {
                const userProfiles = createUserProfiles(Math.max(50, numTransactions / 20));
                for (let i = 0; i < numTransactions; i++) {
                    const user = userProfiles[Math.floor(Math.random() * userProfiles.length)];
                    const isFraud = Math.random() < (fraudPercentage / 100);
                    let transaction = generateTransaction(i, user, isFraud, timeRange, avgAmount, amountDeviation);
                    transaction = attachAutomations(transaction);
                    generatedData.push(transaction);
                }
            } else {
                const applicantProfiles = createApplicantProfiles(Math.max(50, numTransactions / 20));
                for (let i = 0; i < numTransactions; i++) {
                    const applicant = applicantProfiles[Math.floor(Math.random() * applicantProfiles.length)];
                    const isFlagged = Math.random() < (fraudPercentage / 100);
                    let application = generateLoanApplication(i, applicant, isFlagged, timeRange, avgAmount, amountDeviation);
                    application = attachAutomations(application);
                    generatedData.push(application);
                }
            }
            displayResults();
            updateCharts();
            document.getElementById('downloadBtn').disabled = false;
        }

        function createUserProfiles(numUsers) {
            const users = [];
            for (let i = 0; i < numUsers; i++) {
                const userLocation = locations[Math.floor(Math.random() * locations.length)];
                users.push({
                    id: `USER_${1000 + i}`,
                    location: userLocation,
                    usualAmount: 30000 + Math.random() * 140000,
                    transactionTimes: Array.from({length: 7}, () => 8 + Math.floor(Math.random() * 10)),
                    preferredProvider: providers[Math.floor(Math.random() * providers.length)]
                });
            }
            return users;
        }

        function generateTransaction(id, user, isFraud, timeRange, avgAmount, amountDeviation) {
            let timestamp = generateTimestamp(timeRange);
            const type = transactionTypes[Math.floor(Math.random() * transactionTypes.length)];
            let amount = generateAmount(avgAmount, amountDeviation);
            let provider = user.preferredProvider;
            let location = user.location;
            let fraudReason = null;
            if (isFraud) {
                const fraudPattern = Math.floor(Math.random() * 4);
                switch (fraudPattern) {
                    case 0:
                        location = getRandomItem(locations.filter(l => l !== user.location));
                        fraudReason = "Unusual location";
                        break;
                    case 1:
                        amount = avgAmount * 3 + Math.random() * amountDeviation * 5;
                        fraudReason = "Unusual amount";
                        break;
                    case 2:
                        const hour = parseInt(timestamp.split(' ')[1].split(':')[0]);
                        if (hour >= 1 && hour <= 5) {
                            fraudReason = "Unusual time";
                        } else {
                            timestamp = generateTimestamp(timeRange, true);
                            fraudReason = "Unusual time";
                        }
                        break;
                    case 3:
                        provider = providers.find(p => p !== user.preferredProvider) || user.preferredProvider;
                        fraudReason = "New device/provider";
                        break;
                }
            }
            return {
                id: `TXN_${10000 + id}`,
                timestamp: timestamp,
                userId: user.id,
                amount: Math.round(amount),
                type: type,
                provider: provider,
                location: location,
                isFraud: isFraud,
                fraudReason: fraudReason,
                merchant: type === 'merchant' ? `MERCHANT_${Math.floor(1000 + Math.random() * 9000)}` : null,
                category: type === 'merchant' ? getRandomItem(merchantCategories) : null,
                device: getRandomItem(deviceTypes)
            };
        }

        function generateTimestamp(timeRange, unusualTime = false) {
            const now = new Date();
            const pastDate = new Date();
            pastDate.setDate(now.getDate() - timeRange);
            const randomDate = new Date(
                pastDate.getTime() + Math.random() * (now.getTime() - pastDate.getTime())
            );
            let hours, minutes;
            if (unusualTime) {
                hours = Math.floor(Math.random() * 5);
                minutes = Math.floor(Math.random() * 60);
            } else {
                hours = 8 + Math.floor(Math.random() * 10);
                minutes = Math.floor(Math.random() * 60);
            }
            randomDate.setHours(hours, minutes, 0);
            return randomDate.toISOString().replace('T', ' ').substring(0, 16);
        }

        function generateAmount(avgAmount, deviation) {
            const amount = avgAmount + (Math.random() - 0.5) * deviation * 2;
            return Math.max(1000, Math.round(amount));
        }

        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // --- Automation Attachment ---
        function readAutomationConfig() {
            const hold = document.getElementById('enableHold')?.value !== 'no';
            const verification = document.getElementById('enableVerification')?.value !== 'no';
            const internalAlert = document.getElementById('enableInternalAlert')?.value !== 'no';
            const customerNotification = document.getElementById('enableCustomerNotification')?.value === 'yes';
            const lockThreshold = parseInt(document.getElementById('lockThreshold')?.value || '2');
            return { hold, verification, internalAlert, customerNotification, lockThreshold };
        }

        function attachAutomations(record) {
            const cfg = readAutomationConfig();
            const isFlagged = currentDataset === 'transactions' ? !!record.isFraud : !!record.isFlagged;
            const signalCount = currentDataset === 'transactions' ? (record.isFraud ? 1 : 0) : (record.flags ? record.flags.length : 0);
            const actions = [];
            let accountAction = 'none';
            let customerNote = null;
            let internal = null;

            if (isFlagged) {
                if (cfg.hold) actions.push({ type: 'hold', message: 'Transaction flagged — on hold pending review.' });
                if (signalCount >= cfg.lockThreshold) {
                    accountAction = 'lock';
                    actions.push({ type: 'account_lock', message: 'Suspend account until verification is complete.' });
                }
                if (cfg.verification) actions.push({ type: 'verify', message: 'Verify customer identity before approval.' });
                if (cfg.internalAlert) {
                    const idRef = record.id;
                    internal = { channel: ['SMS','Email','Dashboard'][Math.floor(Math.random()*3)], cta: `Review ${idRef} in dashboard.` };
                }
                if (cfg.customerNotification) {
                    customerNote = { message: 'Unusual activity detected. Was this you? Reply YES/NO.', requireResponse: true };
                }
            }

            record.automations = {
                isFlagged,
                holdApplied: isFlagged && cfg.hold || false,
                accountAction,
                verificationRequired: isFlagged && cfg.verification || false,
                actions,
                internalAlert: internal,
                customerNotification: customerNote
            };
            return record;
        }

        // --- Loan Applications Generation ---
        function createApplicantProfiles(numApplicants) {
            const firstNames = ['John','Mary','Peter','Sarah','Paul','Asha','David','Grace','Emma','Noah','Brian','Jane'];
            const lastNames = ['Okello','Nankunda','Kato','Nabirye','Ochen','Mukasa','Kintu','Achieng','Tumwine','Kabugo'];
            const employers = ['Shoprite','Civil Service','Jumia','UMEME','MTN Uganda','Airtel Uganda','Self-Employed','Stanbic','Dfcu','UNRA'];
            const applicants = [];
            for (let i = 0; i < numApplicants; i++) {
                const fullName = `${getRandomItem(firstNames)} ${getRandomItem(lastNames)}`;
                applicants.push({
                    id: `APPL_${1000 + i}`,
                    fullName,
                    nationalId: `CF${Math.floor(10000000 + Math.random()*89999999)}`,
                    phone: `07${Math.floor(100000000 + Math.random()*899999999).toString().slice(0,8)}`,
                    region: getRandomItem(regions),
                    monthlyIncome: 300000 + Math.floor(Math.random()*3000000),
                    employer: getRandomItem(employers),
                    employmentYears: Math.floor(Math.random()*15),
                    pastFlags: {
                        defaulterRegistry: Math.random() < 0.08,
                        docFraud: Math.random() < 0.03
                    }
                });
            }
            return applicants;
        }

        function generateLoanApplication(id, applicant, isFlagged, timeRange, avgAmount, amountDeviation) {
            const timestamp = generateTimestamp(timeRange);
            const amountRequested = Math.max(100000, Math.round(generateAmount(avgAmount * 20, amountDeviation * 40)));
            const termMonths = [6, 12, 18, 24, 36][Math.floor(Math.random()*5)];
            const interestRate = 15 + Math.round(Math.random()*10);
            const channel = getRandomItem(channels);

            const flags = [];
            if (applicant.pastFlags.defaulterRegistry) flags.push('In defaulter registry');
            if (applicant.pastFlags.docFraud) flags.push('Prior document fraud');

            // Dynamic anomaly flags when isFlagged
            if (isFlagged) {
                const possible = [
                    'Identity mismatch',
                    'Income inflation',
                    'Duplicate application',
                    'Location mismatch',
                    'High-risk device'
                ];
                const extraCount = 1 + Math.floor(Math.random()*2);
                for (let i = 0; i < extraCount; i++) {
                    const f = getRandomItem(possible);
                    if (!flags.includes(f)) flags.push(f);
                }
            }

            // Risk score (0-100)
            let riskScore = 20;
            if (flags.length) riskScore += flags.length * 12;
            if (amountRequested > applicant.monthlyIncome * 5) riskScore += 15;
            if (applicant.employmentYears < 1) riskScore += 10;
            if (applicant.pastFlags.defaulterRegistry) riskScore += 25;
            if (applicant.pastFlags.docFraud) riskScore += 20;
            riskScore = Math.max(0, Math.min(100, Math.round(riskScore + (Math.random()*10 - 5))));

            return {
                id: `LN_${10000 + id}`,
                timestamp,
                applicantId: applicant.id,
                fullName: applicant.fullName,
                nationalId: applicant.nationalId,
                phone: applicant.phone,
                region: applicant.region,
                channel,
                amountRequested,
                termMonths,
                interestRate,
                monthlyIncome: applicant.monthlyIncome,
                employer: applicant.employer,
                employmentYears: applicant.employmentYears,
                isFlagged: flags.length > 0,
                flags,
                riskScore
            };
        }

        // --- UI Rendering ---
        function displayResults() {
            document.getElementById('statsContainer').style.display = 'grid';
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('chartsContainer').style.display = 'grid';

            // Stats
            if (currentDataset === 'transactions') {
                const totalTransactions = generatedData.length;
                const fraudTransactions = generatedData.filter(t => t.isFraud).length;
                const totalAmount = generatedData.reduce((sum, t) => sum + t.amount, 0);
                const uniqueUsers = new Set(generatedData.map(t => t.userId)).size;
                document.getElementById('totalTransactions').textContent = totalTransactions.toLocaleString();
                document.getElementById('fraudTransactions').textContent = fraudTransactions.toLocaleString();
                document.getElementById('totalAmount').textContent = Math.round(totalAmount).toLocaleString();
                document.getElementById('uniqueUsers').textContent = uniqueUsers.toLocaleString();
            } else {
                const totalApplications = generatedData.length;
                const flagged = generatedData.filter(a => a.isFlagged).length;
                const totalRequested = generatedData.reduce((sum, a) => sum + a.amountRequested, 0);
                const uniqueApplicants = new Set(generatedData.map(a => a.applicantId)).size;
                document.getElementById('totalTransactions').textContent = totalApplications.toLocaleString();
                document.getElementById('fraudTransactions').textContent = flagged.toLocaleString();
                document.getElementById('totalAmount').textContent = Math.round(totalRequested).toLocaleString();
                document.getElementById('uniqueUsers').textContent = uniqueApplicants.toLocaleString();
            }

            // Filters
            const filterDate = document.getElementById('filterDate')?.value;
            const filterFraud = document.getElementById('filterFraud')?.value;
            const filterProvider = document.getElementById('filterProvider')?.value;
            const filterReason = document.getElementById('filterReason')?.value;

            let filtered = generatedData;
            if (filterDate) {
                filtered = filtered.filter(r => r.timestamp.startsWith(filterDate));
            }
            if (currentDataset === 'transactions') {
                if (filterFraud === "true") filtered = filtered.filter(t => t.isFraud);
                else if (filterFraud === "false") filtered = filtered.filter(t => !t.isFraud);
                if (filterProvider) filtered = filtered.filter(t => t.provider === filterProvider);
                if (filterReason) filtered = filtered.filter(t => t.fraudReason === filterReason);
            } else {
                if (filterFraud === "true") filtered = filtered.filter(a => a.isFlagged);
                else if (filterFraud === "false") filtered = filtered.filter(a => !a.isFlagged);
            }

            // Table
            const tableBody = document.getElementById('tableBody');
            const tableHead = document.getElementById('tableHead');
            tableBody.innerHTML = '';
            if (currentDataset === 'transactions') {
                tableHead.innerHTML = `
                    <tr>
                        <th>Transaction ID</th>
                        <th>Timestamp</th>
                        <th>User ID</th>
                        <th>Amount (UGX)</th>
                        <th>Type</th>
                        <th>Provider</th>
                        <th>Location</th>
                        <th>Is Fraud</th>
                    </tr>`;
            } else {
                tableHead.innerHTML = `
                    <tr>
                        <th>Application ID</th>
                        <th>Timestamp</th>
                        <th>Applicant</th>
                        <th>National ID</th>
                        <th>Amount Requested</th>
                        <th>Region</th>
                        <th>Channel</th>
                        <th>Flags</th>
                        <th>Risk</th>
                    </tr>`;
            }
            let rowsToShow = filtered;
            if (currentRowsPerPage !== "all") {
                rowsToShow = filtered.slice(0, parseInt(currentRowsPerPage));
            }
            rowsToShow.forEach(item => {
                const row = document.createElement('tr');
                if (currentDataset === 'transactions') {
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.timestamp}</td>
                        <td>${item.userId}</td>
                        <td>${item.amount.toLocaleString()}</td>
                        <td>${item.type}</td>
                        <td>${item.provider}</td>
                        <td>${item.location}</td>
                        <td><span class="fraud-tag ${item.isFraud ? 'fraud-yes' : 'fraud-no'}">${item.isFraud ? 'Yes' : 'No'}</span></td>
                    `;
                } else {
                    const flagsText = item.flags && item.flags.length ? item.flags.join(' | ') : 'None';
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.timestamp}</td>
                        <td>${item.fullName}</td>
                        <td>${item.nationalId}</td>
                        <td>${item.amountRequested.toLocaleString()}</td>
                        <td>${item.region}</td>
                        <td>${item.channel}</td>
                        <td><span class="fraud-tag ${item.isFlagged ? 'fraud-yes' : 'fraud-no'}">${item.isFlagged ? flagsText : 'No'}</span></td>
                        <td>${item.riskScore}</td>
                    `;
                }
                row.style.cursor = "pointer";
                row.onclick = () => showTransactionModal(item);
                tableBody.appendChild(row);
            });
        }

        function updateCharts() {
            const chartColors = ['#635bff', '#00d4a1', '#ff8a00', '#6b7c93', '#ef4444', '#10b981'];
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            const fraudCtx = document.getElementById('fraudChart').getContext('2d');
            if (typeChartInstance) typeChartInstance.destroy();
            if (fraudChartInstance) fraudChartInstance.destroy();

            if (currentDataset === 'transactions') {
                const typeCounts = {};
                transactionTypes.forEach(type => {
                    typeCounts[type] = generatedData.filter(t => t.type === type).length;
                });
                typeChartInstance = new Chart(typeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(typeCounts).map(key => key.charAt(0).toUpperCase() + key.slice(1)),
                        datasets: [{ data: Object.values(typeCounts), backgroundColor: chartColors }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });
                const fraudByType = {};
                transactionTypes.forEach(type => {
                    const transactions = generatedData.filter(t => t.type === type);
                    fraudByType[type] = transactions.filter(t => t.isFraud).length;
                });
                fraudChartInstance = new Chart(fraudCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(fraudByType).map(key => key.charAt(0).toUpperCase() + key.slice(1)),
                        datasets: [{ label: 'Fraudulent Transactions', data: Object.values(fraudByType), backgroundColor: chartColors }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });
            } else {
                // Loans: Flags distribution and risk buckets
                const flagCounts = {};
                generatedData.forEach(a => {
                    (a.flags || []).forEach(f => { flagCounts[f] = (flagCounts[f] || 0) + 1; });
                });
                const labels = Object.keys(flagCounts).length ? Object.keys(flagCounts) : ['No Flags'];
                const values = Object.keys(flagCounts).length ? Object.values(flagCounts) : [generatedData.length];
                typeChartInstance = new Chart(typeCtx, {
                    type: 'doughnut',
                    data: { labels, datasets: [{ data: values, backgroundColor: chartColors }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });

                const buckets = { '0-20':0,'21-40':0,'41-60':0,'61-80':0,'81-100':0 };
                generatedData.forEach(a => {
                    const s = a.riskScore;
                    if (s <= 20) buckets['0-20']++; else if (s <= 40) buckets['21-40']++; else if (s <= 60) buckets['41-60']++; else if (s <= 80) buckets['61-80']++; else buckets['81-100']++;
                });
                fraudChartInstance = new Chart(fraudCtx, {
                    type: 'bar',
                    data: { labels: Object.keys(buckets), datasets: [{ label: 'Applications per Risk Bucket', data: Object.values(buckets), backgroundColor: chartColors }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });
            }
        }

        // --- Download Functions ---
        function downloadData() {
            const format = document.getElementById('dataFormat').value;
            if (format === 'json') downloadJSON(); else downloadCSV();
        }

        function downloadJSON() {
            const dataStr = JSON.stringify(generatedData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const prefix = currentDataset === 'transactions' ? 'simpo-transactions' : 'simpo-loans';
            const exportFileDefaultName = `${prefix}-${new Date().toISOString().slice(0,10)}.json`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function downloadCSV() {
            let csvContent = '';
            if (currentDataset === 'transactions') {
                csvContent = "Transaction ID,Timestamp,User ID,Amount,Type,Provider,Location,Is Fraud,Merchant,Category,Device,On Hold,Account Action,Verification Required,Internal Alert,Customer Notification\n";
                generatedData.forEach(t => {
                    const a = t.automations || {};
                    const internal = a.internalAlert ? `${a.internalAlert.channel}:${a.internalAlert.cta}` : '';
                    const cust = a.customerNotification ? a.customerNotification.message : '';
                    csvContent += `"${t.id}","${t.timestamp}","${t.userId}",${t.amount},${t.type},${t.provider},${t.location},${t.isFraud ? 'Yes' : 'No'},${t.merchant || ''},${t.category || ''},${t.device},${a.holdApplied ? 'Yes' : 'No'},${a.accountAction || 'none'},${a.verificationRequired ? 'Yes' : 'No'},"${internal}","${cust}"\n`;
                });
            } else {
                csvContent = "Application ID,Timestamp,Applicant,National ID,Phone,Region,Channel,Amount Requested,Term Months,Interest Rate,Monthly Income,Employer,Employment Years,Is Flagged,Flags,Risk Score,On Hold,Account Action,Verification Required,Internal Alert,Customer Notification\n";
                generatedData.forEach(a => {
                    const flags = (a.flags || []).join('|');
                    const auto = a.automations || {};
                    const internal = auto.internalAlert ? `${auto.internalAlert.channel}:${auto.internalAlert.cta}` : '';
                    const cust = auto.customerNotification ? auto.customerNotification.message : '';
                    csvContent += `"${a.id}","${a.timestamp}","${a.fullName}","${a.nationalId}","${a.phone}",${a.region},${a.channel},${a.amountRequested},${a.termMonths},${a.interestRate},${a.monthlyIncome},${a.employer},${a.employmentYears},${a.isFlagged ? 'Yes' : 'No'},"${flags}",${a.riskScore},${auto.holdApplied ? 'Yes' : 'No'},${auto.accountAction || 'none'},${auto.verificationRequired ? 'Yes' : 'No'},"${internal}","${cust}"\n`;
                });
            }
            const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csvContent);
            const prefix = currentDataset === 'transactions' ? 'simpo-transactions' : 'simpo-loans';
            const exportFileDefaultName = `${prefix}-${new Date().toISOString().slice(0,10)}.csv`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // --- Modal Functions ---
        function showTransactionModal(transaction) {
            const modal = document.getElementById('transactionModal');
            const content = document.getElementById('modalContent');
            const modalTitle = document.getElementById('modalTitle');
            if (currentDataset === 'transactions') {
                modalTitle.textContent = 'Transaction Details';
                const actionsHtml = transaction.automations && transaction.automations.isFlagged ? `
                    <tr><th style="text-align:left;">On Hold</th><td>${transaction.automations.holdApplied ? 'Yes' : 'No'}</td></tr>
                    <tr><th style="text-align:left;">Account Action</th><td>${transaction.automations.accountAction}</td></tr>
                    <tr><th style="text-align:left;">Verification Required</th><td>${transaction.automations.verificationRequired ? 'Yes' : 'No'}</td></tr>
                    ${transaction.automations.internalAlert ? `<tr><th style=\"text-align:left;\">Internal Alert</th><td>${transaction.automations.internalAlert.channel} — ${transaction.automations.internalAlert.cta}</td></tr>` : ''}
                    ${transaction.automations.customerNotification ? `<tr><th style=\"text-align:left;\">Customer Notice</th><td>${transaction.automations.customerNotification.message}</td></tr>` : ''}
                ` : '';
                content.innerHTML = `
                    <table style="width:100%; border-collapse:collapse;">
                        <tr><th style="text-align:left;">Transaction ID</th><td>${transaction.id}</td></tr>
                        <tr><th style="text-align:left;">Timestamp</th><td>${transaction.timestamp}</td></tr>
                        <tr><th style="text-align:left;">User ID</th><td>${transaction.userId}</td></tr>
                        <tr><th style="text-align:left;">Amount</th><td>${transaction.amount.toLocaleString()} UGX</td></tr>
                        <tr><th style="text-align:left;">Type</th><td>${transaction.type}</td></tr>
                        <tr><th style="text-align:left;">Provider</th><td>${transaction.provider}</td></tr>
                        <tr><th style="text-align:left;">Location</th><td>${transaction.location}</td></tr>
                        <tr><th style="text-align:left;">Device</th><td>${transaction.device}</td></tr>
                        ${transaction.merchant ? `<tr><th style="text-align:left;">Merchant</th><td>${transaction.merchant}</td></tr>` : ""}
                        ${transaction.category ? `<tr><th style="text-align:left;">Category</th><td>${transaction.category}</td></tr>` : ""}
                        <tr><th style="text-align:left;">Is Fraud</th><td>${transaction.isFraud ? '<span class="fraud-tag fraud-yes">Yes</span>' : '<span class="fraud-tag fraud-no">No</span>'}</td></tr>
                        ${transaction.isFraud ? `<tr><th style="text-align:left;">Fraud Reason</th><td style="color:#ff3d71;">${transaction.fraudReason || 'Unknown'}</td></tr>` : ""}
                        ${actionsHtml}
                    </table>
                `;
            } else {
                modalTitle.textContent = 'Loan Application Details';
                const flags = (transaction.flags || []).join(', ') || 'None';
                const actionsHtml = transaction.automations && transaction.automations.isFlagged ? `
                    <tr><th style="text-align:left;">On Hold</th><td>${transaction.automations.holdApplied ? 'Yes' : 'No'}</td></tr>
                    <tr><th style="text-align:left;">Account Action</th><td>${transaction.automations.accountAction}</td></tr>
                    <tr><th style="text-align:left;">Verification Required</th><td>${transaction.automations.verificationRequired ? 'Yes' : 'No'}</td></tr>
                    ${transaction.automations.internalAlert ? `<tr><th style=\"text-align:left;\">Internal Alert</th><td>${transaction.automations.internalAlert.channel} — ${transaction.automations.internalAlert.cta}</td></tr>` : ''}
                    ${transaction.automations.customerNotification ? `<tr><th style=\"text-align:left;\">Customer Notice</th><td>${transaction.automations.customerNotification.message}</td></tr>` : ''}
                ` : '';
                content.innerHTML = `
                    <table style="width:100%; border-collapse:collapse;">
                        <tr><th style="text-align:left;">Application ID</th><td>${transaction.id}</td></tr>
                        <tr><th style="text-align:left;">Timestamp</th><td>${transaction.timestamp}</td></tr>
                        <tr><th style="text-align:left;">Applicant</th><td>${transaction.fullName}</td></tr>
                        <tr><th style="text-align:left;">National ID</th><td>${transaction.nationalId}</td></tr>
                        <tr><th style="text-align:left;">Phone</th><td>${transaction.phone}</td></tr>
                        <tr><th style="text-align:left;">Region</th><td>${transaction.region}</td></tr>
                        <tr><th style="text-align:left;">Channel</th><td>${transaction.channel}</td></tr>
                        <tr><th style="text-align:left;">Amount Requested</th><td>${transaction.amountRequested.toLocaleString()} UGX</td></tr>
                        <tr><th style="text-align:left;">Term (months)</th><td>${transaction.termMonths}</td></tr>
                        <tr><th style="text-align:left;">Interest Rate</th><td>${transaction.interestRate}%</td></tr>
                        <tr><th style="text-align:left;">Monthly Income</th><td>${transaction.monthlyIncome.toLocaleString()} UGX</td></tr>
                        <tr><th style="text-align:left;">Employer</th><td>${transaction.employer}</td></tr>
                        <tr><th style="text-align:left;">Employment Years</th><td>${transaction.employmentYears}</td></tr>
                        <tr><th style="text-align:left;">Flagged</th><td>${transaction.isFlagged ? '<span class="fraud-tag fraud-yes">Yes</span>' : '<span class="fraud-tag fraud-no">No</span>'}</td></tr>
                        <tr><th style="text-align:left;">Flags</th><td>${flags}</td></tr>
                        <tr><th style="text-align:left;">Risk Score</th><td>${transaction.riskScore}</td></tr>
                        ${actionsHtml}
                    </table>
                `;
            }
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('transactionModal').classList.remove('active');
        }

        // Workflow modal controls
        function openWorkflow() {
            document.getElementById('workflowModal').classList.add('active');
        }
        function closeWorkflow() {
            document.getElementById('workflowModal').classList.remove('active');
        }

        // --- Initialize ---
        window.onload = function() {
            generateData();
            document.getElementById('filterDate').addEventListener('change', displayResults);
            document.getElementById('filterFraud').addEventListener('change', displayResults);
            document.getElementById('filterProvider').addEventListener('change', displayResults);
            document.getElementById('filterReason').addEventListener('change', displayResults);
            document.getElementById('datasetType').addEventListener('change', () => {
                // Update labels for clarity
                const numLabel = document.querySelector('label[for="numTransactions"]');
                const fraudLabel = document.querySelector('label[for="fraudPercentage"]');
                const fraudHint = document.querySelector('#fraudPercentage')?.nextElementSibling;
                const ds = document.getElementById('datasetType').value;
                if (ds === 'loans') {
                    document.querySelector('.subtitle').textContent = 'Generate realistic datasets for transactions or loan applications with fraud/anomaly flags';
                    // Update inline text only (ids not present on labels originally)
                    const countLabel = document.querySelector('#numTransactions')?.parentElement.querySelector('.form-label');
                    const pctLabel = document.querySelector('#fraudPercentage')?.parentElement.querySelector('.form-label');
                    if (countLabel) countLabel.textContent = 'Number of Applications';
                    if (pctLabel) pctLabel.textContent = 'Flagged Percentage';
                    if (fraudHint) fraudHint.textContent = '% of applications that should be flagged';
                } else {
                    document.querySelector('.subtitle').textContent = 'Generate realistic transaction data for training your fraud detection AI';
                    const countLabel = document.querySelector('#numTransactions')?.parentElement.querySelector('.form-label');
                    const pctLabel = document.querySelector('#fraudPercentage')?.parentElement.querySelector('.form-label');
                    if (countLabel) countLabel.textContent = 'Number of Transactions';
                    if (pctLabel) pctLabel.textContent = 'Fraud Percentage';
                    if (fraudHint) fraudHint.textContent = '% of transactions that should be fraudulent';
                }
                generateData();
            });
        };

        let currentRowsPerPage = 25;

        function setRowsPerPage(val) {
            if (val === 'all' && generatedData.length > 10000) {
                alert('Viewing all transactions is disabled for large datasets. Please use a smaller page size or download the data.');
                return;
            }
            currentRowsPerPage = val;
            displayResults();
        }
    </script>
</body>
</html>